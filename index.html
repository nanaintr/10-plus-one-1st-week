<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ğŸš´ê´‘ëª… ê²½ë¥œ 10+1 1ë§Œì› ë“œë¦¼ í”„ë¡œëª¨ì…˜ 1ì°¨ ì¿ í° ë‹¹ì²¨ ì¡°íšŒğŸš´</title>

  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- PapaParse (CSV íŒŒì‹±ìš©) -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body class="bg-slate-100 min-h-screen">
  <div class="max-w-3xl mx-auto px-4 py-8">
    <h1 class="text-2xl font-bold text-slate-800 mb-2">
      ğŸš´ê´‘ëª… ê²½ë¥œ 10+1 1ë§Œì› ë“œë¦¼ í”„ë¡œëª¨ì…˜ 1ì°¨ ì¿ í° ë‹¹ì²¨ ì¡°íšŒğŸš´
    </h1>
    <p class="text-sm text-slate-600 mb-6">
      íœ´ëŒ€ì „í™” ë²ˆí˜¸ <span class="font-semibold">ë§ˆì§€ë§‰ 4ìë¦¬</span>ë¥¼ ì…ë ¥í•˜ë©´ ì¿ í° ë‹¹ì²¨ ì—¬ë¶€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
      ì˜ˆ: ë²ˆí˜¸ê°€ <span class="font-mono">010-1234-<span class="underline">5678</span></span> ì´ë¼ë©´ <span class="font-mono">5678</span> ì…ë ¥
    </p>

    <!-- ê²€ìƒ‰ í¼ -->
    <form id="search-form" class="flex flex-col sm:flex-row gap-3 items-start sm:items-center mb-4">
      <div class="flex items-center gap-2">
        <label for="last4" class="text-sm font-medium text-slate-700 whitespace-nowrap">
          íœ´ëŒ€í° ë 4ìë¦¬
        </label>
        <input
          id="last4"
          type="text"
          inputmode="numeric"
          maxlength="4"
          class="w-28 px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono text-center"
          placeholder="1234"
        />
      </div>
      <button
        type="submit"
        class="px-4 py-2 bg-blue-600 text-white rounded-md shadow hover:bg-blue-700 transition text-sm font-medium"
      >
        ì¡°íšŒí•˜ê¸°
      </button>
    </form>

    <!-- ìƒíƒœ ë©”ì‹œì§€ -->
    <div id="status" class="text-sm text-slate-600 mb-3">
      ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤â€¦
    </div>

    <!-- ê²°ê³¼ ì˜ì—­ -->
    <div id="results-container" class="bg-white border border-slate-200 rounded-lg shadow-sm overflow-hidden hidden">
      <table class="min-w-full text-sm">
        <thead class="bg-slate-50 border-b border-slate-200">
          <tr>
            <th class="px-4 py-2 text-left font-semibold text-slate-700">ì´ë¦„</th>
            <th class="px-4 py-2 text-left font-semibold text-slate-700">íœ´ëŒ€í°ë²ˆí˜¸</th>
            <th class="px-4 py-2 text-right font-semibold text-slate-700">ì¿ í°ê¸ˆì•¡</th>
          </tr>
        </thead>
        <tbody id="results-body" class="divide-y divide-slate-100">
        </tbody>
      </table>
    </div>
  </div>

  <script>
    // ğŸ”— êµ¬ê¸€ ì‹œíŠ¸ "ì›¹ì— ê²Œì‹œ" â†’ CSV í˜•ì‹ ì£¼ì†Œë¡œ ë°”ê¿” ë„£ê¸°
    // ì˜ˆ: https://docs.google.com/spreadsheets/d/1QVseb_kf96bXRAsjSCUKY4-FFbskUTHZAWI60K9yI1k/pub?output=csv
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTcabHB4nh1SOD6U4adGjJ97PXhE6N2Lk8Zn2znqTImDyPnN2QNC3FPez7eOeWYu_nMS9_OSKOImlLE/pub?output=csv";

    // ì‹œíŠ¸ í—¤ë” ì´ë¦„ (ì‹¤ì œ ì‹œíŠ¸ í—¤ë”ì™€ ë§ì¶°ì£¼ì„¸ìš”)
    const NAME_KEYS = ["ì´ë¦„", "ì´ë¦„(ê°œì¸ì •ë³´ë³´í˜¸)"];
    const PHONE_KEYS = ["íœ´ëŒ€í°ë²ˆí˜¸", "íœ´ëŒ€í°ë²ˆí˜¸(ê°œì¸ì •ë³´ë³´í˜¸)"];
    const COUPON_KEYS = ["ì¿ í°ê¸ˆì•¡", "ì¿ í° ê¸ˆì•¡"];

    let rows = [];
    let isLoaded = false;

    const statusEl = document.getElementById("status");
    const resultsContainer = document.getElementById("results-container");
    const resultsBody = document.getElementById("results-body");
    const form = document.getElementById("search-form");
    const last4Input = document.getElementById("last4");

    // ìœ í‹¸: ê°€ëŠ¥í•œ í‚¤ ì¤‘ ì‹¤ì œë¡œ ì¡´ì¬í•˜ëŠ” ì»¬ëŸ¼ì„ ì°¾ê¸°
    function getField(row, keys) {
      for (const k of keys) {
        if (k in row) return row[k];
      }
      return "";
    }

    // CSV ë¶ˆëŸ¬ì˜¤ê¸°
    function loadData() {
      Papa.parse(CSV_URL, {
        download: true,
        header: true,
        encoding: "UTF-8",
        complete: function (results) {
          rows = results.data.filter(r => Object.keys(r).length > 0);
          isLoaded = true;
          statusEl.textContent = "ë°ì´í„°ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤. íœ´ëŒ€í° ë 4ìë¦¬ë¥¼ ì…ë ¥í•´ ì¡°íšŒí•´ì£¼ì„¸ìš”.";
        },
        error: function (err) {
          console.error(err);
          statusEl.textContent = "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
        }
      });
    }

    // ê²€ìƒ‰ ì²˜ë¦¬
    form.addEventListener("submit", function (e) {
      e.preventDefault();
      const last4 = last4Input.value.trim();

      if (!isLoaded) {
        statusEl.textContent = "ì•„ì§ ë°ì´í„°ê°€ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.";
        return;
      }

      if (!/^\d{4}$/.test(last4)) {
        statusEl.textContent = "íœ´ëŒ€í° ë²ˆí˜¸ ë 4ìë¦¬ë¥¼ ìˆ«ì 4ìë¦¬ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: 5678)";
        resultsContainer.classList.add("hidden");
        resultsBody.innerHTML = "";
        return;
      }

      // ë 4ìë¦¬ë¡œ í•„í„°
      const matches = rows.filter(row => {
        const phoneRaw = (getField(row, PHONE_KEYS) || "").toString().replace(/\s+/g, "");
        return phoneRaw.endsWith(last4);
      });

      if (matches.length === 0) {
        statusEl.textContent =
          "ì£„ì†¡í•©ë‹ˆë‹¤.ğŸ˜¢ ì…ë ¥í•˜ì‹  ë²ˆí˜¸ì™€ ì¼ì¹˜í•˜ëŠ” ì¿ í° ë‹¹ì²¨ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤. 12ì›” 19ì¼~21ì¼ì— ë‹¤ì‹œ ë„ì „í•´ì£¼ì„¸ìš”.";
        resultsContainer.classList.add("hidden");
        resultsBody.innerHTML = "";
        return;
      }

      // ê²°ê³¼ í…Œì´ë¸” ë Œë”
      resultsBody.innerHTML = "";
      matches.forEach(row => {
        const name = getField(row, NAME_KEYS) || "";
        const phone = getField(row, PHONE_KEYS) || "";
        const coupon = getField(row, COUPON_KEYS) || "";

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="px-4 py-2 text-slate-800">${name}</td>
          <td class="px-4 py-2 font-mono text-slate-700">${phone}</td>
          <td class="px-4 py-2 text-right text-slate-800 font-semibold">${coupon}</td>
        `;
        resultsBody.appendChild(tr);
      });

      statusEl.innerHTML =
        "ì¶•í•˜ë“œë ¤ìš”! ğŸ¥³ğŸ‘ ì•„ë˜ì—ì„œ ë‹¹ì²¨ ê²°ê³¼ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.<br>ì´ " +
        matches.length +
        "ê±´ì˜ ë‹¹ì²¨ ë‚´ì—­ì´ ìˆìŠµë‹ˆë‹¤.";
      resultsContainer.classList.remove("hidden");
    });

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë¡œë”©
    window.addEventListener("DOMContentLoaded", loadData);
  </script>
</body>
</html>
